(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[840],{4571:function(e,t,s){Promise.resolve().then(s.bind(s,6846))},6846:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return w}});var a=s(7573),r=s(7930),i=s(1988),n=s(5969),l=s(8623),o=s(2461),d=s(3029),c=s(5721),u=s(3172),m=s(4700),h=s(6987),x=s(7354),p=s(1856),v=s(9585),g=s(2041),f=s(590),y=s(6798),j=s(8962),b=s(4012);function N(e){let{data:t}=e,s=t.map(e=>e.ts),r=t.flatMap(e=>[e.delivered,e.failed]),i=s.length?Math.min(...s):0,n=s.length?Math.max(...s):1,l=Math.max(1,r.length?Math.max(...r):0),o=e=>28+(e-i)/(n-i||1)*744,d=e=>252-(e-0)/(l-0||1)*224,c=e=>t.map(t=>"".concat(o(t.ts),",").concat(d(t[e]))).join(" "),u=[];for(let e=0;e<=5;e++){let t=28+224*e/5;u.push((0,a.jsx)("line",{x1:28,y1:t,x2:772,y2:t,stroke:"#eee"},"g-".concat(e)))}return(0,a.jsxs)("svg",{width:"100%",viewBox:"0 0 ".concat(800," ").concat(280),role:"img","aria-label":"Entregas por hora",children:[(0,a.jsx)("rect",{x:0,y:0,width:800,height:280,fill:"#fff"}),u,(0,a.jsx)("polyline",{points:c("delivered"),fill:"none",stroke:"#10b981",strokeWidth:2}),(0,a.jsx)("polyline",{points:c("failed"),fill:"none",stroke:"#ef4444",strokeWidth:2})]})}function w(){var e,t,s,x,p,g,w,I,E,D;let M=(0,r.NL)(),[L,U]=(0,v.useState)(null),[Z,R]=(0,v.useState)({name:"",scopes:"*,hr:read,hr:write,partners:read,partners:webhooks,partners:replay,sandbox:manage,sandbox:events"}),[F,J]=(0,v.useState)({url:"",eventTypes:"hr.person.created,fin.payment.created"}),[A,W]=(0,v.useState)(null),[K,H]=(0,v.useState)(null),[B,Q]=(0,v.useState)("all"),[_,X]=(0,v.useState)(""),[V,Y]=(0,v.useState)(""),[G,$]=(0,v.useState)(""),[ee,et]=(0,v.useState)("");function es(e){let t=e=>String(e).padStart(2,"0"),s=e.getFullYear(),a=t(e.getMonth()+1),r=t(e.getDate()),i=t(e.getHours()),n=t(e.getMinutes());return"".concat(s,"-").concat(a,"-").concat(r,"T").concat(i,":").concat(n)}let ea=e=>{H(e),setTimeout(()=>H(null),1200)},[er,ei]=(0,v.useState)("hr.person.created"),[en,el]=(0,v.useState)(""),eo=(0,i.a)({queryKey:["partners"],queryFn:()=>b.apiClient.listPartners()}),ed=(0,v.useMemo)(()=>{var e;return(null===(e=eo.data)||void 0===e?void 0:e.find(e=>e.id===L))||null},[eo.data,L]),[ec,eu]=(0,v.useState)(0),em=(0,i.a)({queryKey:["partners",null==ed?void 0:ed.id,"logs",B,_,V,G,ec],queryFn:()=>ed?b.apiClient.listPartnerLogsPaged(ed.id,{status:B,q:_||void 0,from:V||void 0,to:G||void 0,limit:50,offset:50*ec,sort:"desc"}):Promise.resolve({items:[],total:0,limit:50,offset:0}),enabled:!!(null==ed?void 0:ed.id)}),[eh,ex]=(0,v.useState)(null),ep=(0,i.a)({queryKey:["partners",null==ed?void 0:ed.id,"webhooks"],queryFn:()=>ed?b.apiClient.listWebhooks(ed.id):Promise.resolve([]),enabled:!!(null==ed?void 0:ed.id)}),ev=(0,i.a)({queryKey:["webhooks","catalog"],queryFn:()=>b.apiClient.getWebhookCatalog()}),eg=(0,n.D)({mutationFn:()=>b.apiClient.createPartner({name:Z.name,scopes:Z.scopes.split(",").map(e=>e.trim()).filter(Boolean)}),onSuccess:async e=>{R({name:"",scopes:Z.scopes}),U(e.id),W({id:e.id,clientId:e.clientId,clientSecret:e.clientSecret,webhookSecret:e.webhookSecret}),await M.invalidateQueries({queryKey:["partners"]})}}),ef=(0,n.D)({mutationFn:e=>b.apiClient.rotatePartnerCredentials(e),onSuccess:async e=>{W({id:e.id,clientId:e.clientId,clientSecret:e.clientSecret,webhookSecret:e.webhookSecret}),await M.invalidateQueries({queryKey:["partners"]})}}),ey=(0,n.D)({mutationFn:()=>ed?b.apiClient.createWebhook(ed.id,{url:F.url,eventTypes:F.eventTypes.split(",").map(e=>e.trim()).filter(Boolean)}):Promise.resolve(null),onSuccess:async()=>{J({url:"",eventTypes:F.eventTypes}),ed&&await M.invalidateQueries({queryKey:["partners",ed.id,"webhooks"]})}}),ej=(0,n.D)({mutationFn:e=>ed?b.apiClient.replayDelivery(ed.id,e):Promise.resolve(null),onSuccess:async()=>{ed&&await M.invalidateQueries({queryKey:["partners",ed.id,"logs"]})}}),eb=(0,v.useMemo)(()=>{var e,t;let s=(null===(e=em.data)||void 0===e?void 0:e.items)||[];return{delivered:s.filter(e=>"delivered"===e.status).length,failed:s.filter(e=>"failed"===e.status).length,queued:s.filter(e=>"queued"===e.status).length,total:(null===(t=em.data)||void 0===t?void 0:t.total)||s.length}},[em.data]),eN=(0,v.useMemo)(()=>{var e;let t=((null===(e=em.data)||void 0===e?void 0:e.items)||[]).slice().sort((e,t)=>e.timestamp-t.timestamp),s={};for(let e of t){let t=new Date(e.timestamp),a="".concat(t.getFullYear(),"-").concat(t.getMonth()+1,"-").concat(t.getDate()," ").concat(t.getHours(),":00");s[a]||(s[a]={ts:new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()).getTime(),delivered:0,failed:0}),"delivered"===e.status&&s[a].delivered++,"failed"===e.status&&s[a].failed++}return Object.values(s).sort((e,t)=>e.ts-t.ts)},[em.data]),ew=(0,v.useMemo)(()=>{var e;return(null===(e=em.data)||void 0===e?void 0:e.items)||[]},[em.data]);return(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Portal de Parceiros"}),(0,a.jsxs)(f.zx,{variant:"secondary",onClick:()=>M.invalidateQueries({queryKey:["partners"]}),children:[(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"})," Atualizar"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Parceiros"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:null!==(E=null===(e=eo.data)||void 0===e?void 0:e.length)&&void 0!==E?E:0})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Webhooks (parceiro atual)"}),(0,a.jsx)("div",{className:"text-2xl font-bold",children:null!==(D=null===(t=ep.data)||void 0===t?void 0:t.length)&&void 0!==D?D:0})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Entregues"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-emerald-600",children:eb.delivered})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Falhas"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-600",children:eb.failed})]})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Entregas por hora"}),(0,a.jsx)("div",{className:"text-lg font-semibold",children:ed?ed.name:"Selecione um parceiro"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{className:"border rounded-md px-3 py-2",value:L||"",onChange:e=>U(e.target.value||null),children:[(0,a.jsx)("option",{value:"",children:"— selecionar —"}),null===(s=eo.data)||void 0===s?void 0:s.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),ed&&(0,a.jsxs)(f.zx,{variant:"outline",onClick:()=>ef.mutate(ed.id),children:[(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"})," Rotacionar Credenciais"]})]})]}),(0,a.jsx)("div",{className:"w-full",children:(0,a.jsx)(N,{data:eN})})]}),ed&&(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Credenciais do Parceiro — ",ed.name]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground",children:"Por seguran\xe7a, segredos completos s\xf3 aparecem ao criar ou rotacionar."})]}),A?(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,a.jsx)(S,{label:"Client ID",value:A.clientId,onCopied:()=>ea("clientId"),copied:"clientId"===K}),(0,a.jsx)(S,{label:"Client Secret",value:A.clientSecret,onCopied:()=>ea("clientSecret"),copied:"clientSecret"===K,secret:!0}),(0,a.jsx)(S,{label:"Webhook Secret",value:A.webhookSecret,onCopied:()=>ea("webhookSecret"),copied:"webhookSecret"===K,secret:!0})]}):(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Gere novas credenciais usando “Rotacionar Credenciais” para exibir os segredos."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Parceiros"}),(0,a.jsxs)(f.zx,{variant:"outline",onClick:()=>M.invalidateQueries({queryKey:["partners"]}),children:[(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"})," Atualizar"]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(eo.data||[]).map(e=>(0,a.jsxs)("div",{className:"border rounded p-3 flex items-center justify-between ".concat((null==ed?void 0:ed.id)===e.id?"border-emerald-500":"border-muted"),children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.name}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.scopes.join(", ")})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsxs)(f.zx,{variant:"secondary",onClick:()=>U(e.id),children:["Ver ",(0,a.jsx)(d.Z,{className:"w-4 h-4 ml-2"})]})})]},e.id)),eo.isLoading&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2 animate-spin"})," Carregando…"]})]})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-lg font-semibold mb-4",children:"Criar Parceiro"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Nome"}),(0,a.jsx)(j.II,{value:Z.name,onChange:e=>R({...Z,name:e.target.value}),placeholder:"Ex.: Banco XYZ"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Escopos (v\xedrgula)"}),(0,a.jsx)(j.II,{value:Z.scopes,onChange:e=>R({...Z,scopes:e.target.value})})]}),(0,a.jsxs)(f.zx,{onClick:()=>eg.mutate(),disabled:eg.isPending||!Z.name.trim(),children:[(0,a.jsx)(u.Z,{className:"w-4 h-4 mr-2"})," Criar Parceiro"]})]})]})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Webhooks ",ed?"— ".concat(ed.name):""]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(j.II,{style:{minWidth:320},placeholder:"https://exemplo.com/webhook",value:F.url,onChange:e=>J({...F,url:e.target.value})}),(0,a.jsx)(j.II,{style:{minWidth:280},placeholder:"eventTypes (v\xedrgula)",value:F.eventTypes,onChange:e=>J({...F,eventTypes:e.target.value})}),(0,a.jsxs)(f.zx,{onClick:()=>ey.mutate(),disabled:!ed||!F.url,children:[(0,a.jsx)(m.Z,{className:"w-4 h-4 mr-2"})," Adicionar Webhook"]})]})]}),!ed&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Selecione um parceiro para visualizar e cadastrar webhooks."}),ed&&(0,a.jsxs)("div",{className:"space-y-2",children:[(ep.data||[]).map(e=>(0,a.jsxs)("div",{className:"border rounded p-3",children:[(0,a.jsx)("div",{className:"font-medium",children:e.url}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.eventTypes.join(", ")})]},e.id)),ep.isLoading&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2 animate-spin"})," Carregando…"]})]})]}),ed&&(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsx)("div",{className:"text-lg font-semibold mb-3",children:"Sandbox — Disparar Evento de Teste"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row md:items-end gap-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Tipo de evento"}),(0,a.jsx)("select",{className:"border rounded-md px-3 py-2 w-full",value:er,onChange:e=>ei(e.target.value),children:((null===(x=ev.data)||void 0===x?void 0:x.items)||[{type:"hr.person.created"},{type:"hr.person.updated"},{type:"fin.payment.created"},{type:"fin.payment.failed"}]).map(e=>(0,a.jsx)("option",{value:e.type,children:e.type},e.type))})]}),(0,a.jsxs)("div",{className:"flex-[2]",children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Payload (JSON opcional)"}),(0,a.jsx)(j.II,{placeholder:'{"id":"123"}',value:en,onChange:e=>el(e.target.value)})]}),(0,a.jsx)("div",{children:(0,a.jsx)(f.zx,{onClick:async()=>{try{let e=en.trim()?JSON.parse(en):void 0;await b.apiClient.sandboxEmitEvent(er,e),await M.invalidateQueries({queryKey:["partners",ed.id,"logs"]})}catch(e){alert("Payload inv\xe1lido: "+((null==e?void 0:e.message)||""))}},children:"Disparar"})})]}),(0,a.jsx)("div",{className:"text-xs text-muted-foreground mt-2",children:"Dica: registre um webhook no parceiro para os tipos de evento acima para ver as entregas nos logs."})]}),(0,a.jsxs)(y.Zb,{className:"p-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Logs de Entrega ",ed?"— ".concat(ed.name):""]}),ed&&(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("select",{className:"border rounded-md px-2 py-1 text-sm",value:B,onChange:e=>Q(e.target.value),children:[(0,a.jsx)("option",{value:"all",children:"status: todos"}),(0,a.jsx)("option",{value:"delivered",children:"status: delivered"}),(0,a.jsx)("option",{value:"failed",children:"status: failed"}),(0,a.jsx)("option",{value:"queued",children:"status: queued"})]}),(0,a.jsx)(j.II,{className:"h-8",placeholder:"buscar por id/evento/erro/http",value:_,onChange:e=>X(e.target.value)}),(0,a.jsxs)("select",{className:"h-8 border rounded px-2 text-sm",value:ee,onChange:e=>(function(e){et(e);let t=new Date;"30m"===e?(Y(es(new Date(t.getTime()-18e5))),$(es(t)),eu(0)):"24h"===e?(Y(es(new Date(t.getTime()-864e5))),$(es(t)),eu(0)):"7d"===e?(Y(es(new Date(t.getTime()-6048e5))),$(es(t)),eu(0)):"all"===e&&(Y(""),$(""),eu(0))})(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"intervalo…"}),(0,a.jsx)("option",{value:"30m",children:"\xdaltimos 30m"}),(0,a.jsx)("option",{value:"24h",children:"\xdaltimas 24h"}),(0,a.jsx)("option",{value:"7d",children:"\xdaltimos 7 dias"}),(0,a.jsx)("option",{value:"all",children:"Tudo"})]}),(0,a.jsx)("input",{className:"h-8 border rounded px-2 text-sm",type:"datetime-local",value:V,onChange:e=>Y(e.target.value)}),(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"→"}),(0,a.jsx)("input",{className:"h-8 border rounded px-2 text-sm",type:"datetime-local",value:G,onChange:e=>$(e.target.value)}),(0,a.jsx)(f.zx,{size:"sm",variant:"ghost",onClick:()=>{Q("all"),X(""),Y(""),$(""),et(""),eu(0)},children:"Limpar"}),(0,a.jsxs)(f.zx,{variant:"outline",onClick:()=>M.invalidateQueries({queryKey:["partners",ed.id,"logs"]}),children:[(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"})," Atualizar"]})]})]}),!ed&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"Selecione um parceiro para visualizar logs."}),ed&&(0,a.jsxs)("div",{className:"overflow-auto",children:[(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left border-b",children:[(0,a.jsx)("th",{className:"py-2 pr-4",children:"ID"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Evento"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Status"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Tentativas"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"HTTP"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"Quando"}),(0,a.jsx)("th",{className:"py-2 pr-4",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{children:ew.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("td",{className:"py-2 pr-4 font-mono text-xs",children:e.id}),(0,a.jsx)("td",{className:"py-2 pr-4",children:e.event}),(0,a.jsx)("td",{className:"py-2 pr-4",children:(0,a.jsx)(C,{status:e.status})}),(0,a.jsx)("td",{className:"py-2 pr-4",children:e.attempt}),(0,a.jsx)("td",{className:"py-2 pr-4",children:null!==(t=e.responseStatus)&&void 0!==t?t:"-"}),(0,a.jsx)("td",{className:"py-2 pr-4",children:new Date(e.timestamp).toLocaleString()}),(0,a.jsx)("td",{className:"py-2 pr-4",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(f.zx,{size:"sm",variant:"outline",onClick:()=>ej.mutate(e.id),children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"})," Reenviar"]}),(0,a.jsx)(f.zx,{size:"sm",variant:"ghost",onClick:()=>ex(e),children:"Detalhes"})]})})]},e.id)})})]}),em.isLoading&&(0,a.jsxs)("div",{className:"text-sm text-muted-foreground flex items-center mt-2",children:[(0,a.jsx)(c.Z,{className:"w-4 h-4 mr-2 animate-spin"})," Carregando…"]}),(0,a.jsxs)("div",{className:"flex items-center justify-between mt-3 text-sm",children:[(0,a.jsxs)("div",{children:["Total: ",(null===(p=em.data)||void 0===p?void 0:p.total)||0]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f.zx,{size:"sm",variant:"outline",disabled:0===ec,onClick:()=>eu(e=>Math.max(0,e-1)),children:"Anterior"}),(0,a.jsxs)("div",{children:["P\xe1gina ",ec+1]}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",disabled:((null===(g=em.data)||void 0===g?void 0:g.offset)||0)+((null===(w=em.data)||void 0===w?void 0:w.limit)||50)>=((null===(I=em.data)||void 0===I?void 0:I.total)||0),onClick:()=>eu(e=>e+1),children:"Pr\xf3xima"}),(0,a.jsx)(f.zx,{size:"sm",variant:"secondary",onClick:()=>P(ew),children:"Exportar CSV (p\xe1gina)"}),(0,a.jsx)(f.zx,{size:"sm",variant:"secondary",onClick:()=>T(ed.id,{status:B,q:_||void 0,from:V||void 0,to:G||void 0}),children:"Exportar CSV (tudo)"}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",onClick:()=>q(ew),children:"Exportar JSON (p\xe1gina)"}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",onClick:()=>z(ed.id,{status:B,q:_||void 0,from:V||void 0,to:G||void 0}),children:"Exportar JSON (tudo)"}),(0,a.jsx)(O,{disabled:!ed,logs:ew,onReplay:async()=>{ed&&await M.invalidateQueries({queryKey:["partners",ed.id,"logs"]})},partnerId:(null==ed?void 0:ed.id)||""})]})]})]})]}),(0,a.jsx)(k,{open:!!eh,onClose:()=>ex(null),children:eh&&(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"text-lg font-semibold",children:["Entrega ",eh.id]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Payload"}),(0,a.jsx)("pre",{className:"bg-gray-50 border rounded p-2 text-xs overflow-auto",style:{maxHeight:300},children:JSON.stringify(eh.payload,null,2)}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>navigator.clipboard.writeText(JSON.stringify(eh.payload)),children:"Copiar payload"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:"Resposta HTTP"}),(0,a.jsx)("pre",{className:"bg-gray-50 border rounded p-2 text-xs overflow-auto",style:{maxHeight:300},children:eh.responseBody||"-"}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>navigator.clipboard.writeText(eh.responseBody||""),children:"Copiar resposta"})]})]})]})})]})}function S(e){let{label:t,value:s,secret:r,onCopied:i,copied:n}=e,l=r?s.replace(/.(?=.{4})/g,"•"):s,o=async()=>{try{await navigator.clipboard.writeText(s),i()}catch(e){}};return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-muted-foreground mb-1",children:t}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{readOnly:!0,value:l,className:"w-full rounded-md border px-3 py-2 font-mono text-xs"}),(0,a.jsx)(f.zx,{size:"sm",variant:"outline",onClick:o,"aria-label":"Copiar ".concat(t),children:n?(0,a.jsx)(x.Z,{className:"w-4 h-4"}):(0,a.jsx)(p.Z,{className:"w-4 h-4"})})]})]})}function C(e){let{status:t}=e;return(0,a.jsx)(g.C,{className:{delivered:"bg-emerald-100 text-emerald-800",failed:"bg-red-100 text-red-800",queued:"bg-gray-100 text-gray-800"}[t]||"bg-gray-100 text-gray-800",children:t})}function k(e){let{open:t,onClose:s,children:r}=e;return t?(0,a.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[(0,a.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:s}),(0,a.jsxs)("div",{className:"relative bg-white rounded-lg shadow-lg max-w-5xl w-[92vw] p-4",children:[(0,a.jsx)("div",{className:"absolute top-2 right-2",children:(0,a.jsx)(f.zx,{size:"sm",variant:"ghost",onClick:s,children:"Fechar"})}),r]})]}):null}function P(e){let t=["id","event","status","attempt","responseStatus","timestamp"],s=e=>'"'+String(null!=e?e:"").replace(/"/g,'""')+'"',a=new Blob([[t.join(",")].concat(e.map(e=>t.map(t=>s(e[t])).join(","))).join("\n")],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download="partner-logs.csv",i.click(),URL.revokeObjectURL(r)}async function T(e,t){try{let a=0,r=0,i=[],{apiClient:n}=await Promise.resolve().then(s.bind(s,4012));do{let{items:s,total:l}=await n.listPartnerLogsPaged(e,{...t,limit:500,offset:a,sort:"desc"});r=l,i.push(...s),a+=s.length}while(a<r&&i.length<25e3);P(i)}catch(e){alert("Falha ao exportar CSV: "+((null==e?void 0:e.message)||"erro desconhecido"))}}function q(e){let t=new Blob([JSON.stringify(e,null,2)],{type:"application/json;charset=utf-8;"}),s=URL.createObjectURL(t),a=document.createElement("a");a.href=s,a.download="partner-logs.json",a.click(),URL.revokeObjectURL(s)}async function z(e,t){try{let a=0,r=0,i=[],{apiClient:n}=await Promise.resolve().then(s.bind(s,4012));do{let{items:s,total:l}=await n.listPartnerLogsPaged(e,{...t,limit:500,offset:a,sort:"desc"});r=l,i.push(...s),a+=s.length}while(a<r&&i.length<25e3);q(i)}catch(e){alert("Falha ao exportar JSON: "+((null==e?void 0:e.message)||"erro desconhecido"))}}function O(e){let{logs:t,partnerId:s,onReplay:r,disabled:i}=e,[n,l]=(0,v.useState)(!1),[o,d]=(0,v.useState)(0),c=t.filter(e=>"failed"===e.status),u=c.length,m=async()=>{if(s&&0!==u&&confirm("Reenviar ".concat(u," entrega(s) com falha?"))){l(!0),d(0);try{for(let e of c){try{await b.apiClient.request("/api/v1/partners/".concat(s,"/webhooks/").concat(e.id,"/replay"),{method:"POST"})}catch(e){}d(e=>e+1)}await r()}finally{l(!1)}}};return(0,a.jsxs)(f.zx,{size:"sm",variant:"destructive",disabled:i||n||0===u,onClick:m,title:u?"".concat(u," falha(s) nesta p\xe1gina"):"Sem falhas nesta p\xe1gina",children:[(0,a.jsx)(h.Z,{className:"w-4 h-4 mr-2"})," ",n?"Reenviando… (".concat(o,"/").concat(u,")"):"Reenviar falhas (p\xe1gina)"]})}},590:function(e,t,s){"use strict";s.d(t,{zx:function(){return i}});var a=s(7573),r=s(607);s(9585);let i=function(e){let{className:t,variant:s="primary",size:i="md",loading:n,children:l,disabled:o,...d}=e;return(0,a.jsxs)("button",{className:(0,r.W)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{"bg-blue-600 text-white hover:bg-blue-700 focus-visible:ring-blue-600":"primary"===s||"default"===s,"bg-gray-200 text-gray-900 hover:bg-gray-300 focus-visible:ring-gray-500 border border-gray-300":"secondary"===s||"outline"===s,"hover:bg-gray-100 focus-visible:ring-gray-500":"ghost"===s,"bg-red-600 text-white hover:bg-red-700 focus-visible:ring-red-600":"danger"===s||"destructive"===s,"h-8 px-3 text-sm":"sm"===i,"h-10 px-4 text-sm":"md"===i,"h-12 px-6 text-base":"lg"===i},t),disabled:o||n,...d,children:[n&&(0,a.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),l]})}},8962:function(e,t,s){"use strict";s.d(t,{II:function(){return i}});var a=s(7573),r=s(607);s(9585);let i=function(e){let{className:t,label:s,error:i,helperText:n,id:l,...o}=e,d=l||"input-".concat(Math.random().toString(36).substr(2,9));return(0,a.jsxs)("div",{className:"space-y-1",children:[s&&(0,a.jsx)("label",{htmlFor:d,className:"block text-sm font-medium text-gray-700",children:s}),(0,a.jsx)("input",{id:d,className:(0,r.W)("block w-full rounded-md border-0 py-1.5 px-3 text-gray-900 shadow-sm ring-1 ring-inset placeholder:text-gray-400 focus:ring-2 focus:ring-inset sm:text-sm sm:leading-6",i?"ring-red-300 focus:ring-red-600":"ring-gray-300 focus:ring-blue-600",t),...o}),i&&(0,a.jsx)("p",{className:"text-sm text-red-600",children:i}),n&&!i&&(0,a.jsx)("p",{className:"text-sm text-gray-500",children:n})]})}},2041:function(e,t,s){"use strict";s.d(t,{C:function(){return r}});var a=s(7573);function r(e){let{className:t="",...s}=e;return(0,a.jsx)("span",{className:"inline-flex items-center rounded-md bg-gray-100 px-2 py-1 text-xs font-medium text-gray-700 ".concat(t),...s})}},6798:function(e,t,s){"use strict";s.d(t,{Ol:function(){return i},Zb:function(){return r},aY:function(){return n},ll:function(){return l}});var a=s(7573);function r(e){let{className:t="",...s}=e;return(0,a.jsx)("div",{className:"rounded-lg border border-gray-200 bg-white shadow-sm ".concat(t),...s})}function i(e){let{className:t="",...s}=e;return(0,a.jsx)("div",{className:"p-4 border-b border-gray-100 ".concat(t),...s})}function n(e){let{className:t="",...s}=e;return(0,a.jsx)("div",{className:"p-4 ".concat(t),...s})}function l(e){let{className:t="",...s}=e;return(0,a.jsx)("h3",{className:"text-base font-semibold leading-6 text-gray-900 ".concat(t),...s})}},4012:function(e,t,s){"use strict";s.d(t,{apiClient:function(){return i}});let a=s(8571).env.NEXT_PUBLIC_API_URL||"http://localhost:3000";class r{getSubdomain(){let e=window.location.hostname.split(".");return e.length>2?e[0]:null}setTenant(e){this.tenantId=e||null}setToken(e){this.token=e||null}uuid(){try{var e;let t=globalThis;if(null==t?void 0:null===(e=t.crypto)||void 0===e?void 0:e.randomUUID)return t.crypto.randomUUID()}catch(e){}return"id-"+Math.random().toString(16).slice(2)+Date.now().toString(16)}getHeaders(e){let t=this.uuid();this.lastCorrelationId=t;let s={"X-Correlation-Id":t};this.token&&(s.Authorization="Bearer ".concat(this.token));let a=this.getSubdomain();return a&&(s["x-subdomain"]=a),e&&(s["Idempotency-Key"]=e),s}isAbsoluteUrl(e){return/^https?:\/\//i.test(e)}buildUrl(e){return this.isAbsoluteUrl(e)?e:"".concat(this.baseURL).concat(e)}async sleep(e){return new Promise(t=>setTimeout(t,e))}async doFetch(e,t,a){var r,i,n;let l;let{pushLog:o}=await s.e(565).then(s.bind(s,7565)),d=null!==(r=null==a?void 0:a.timeoutMs)&&void 0!==r?r:1e4,c=Math.max(0,null!==(i=null==a?void 0:a.retries)&&void 0!==i?i:1),u=null!==(n=null==a?void 0:a.retryOnStatuses)&&void 0!==n?n:[429,502,503,504],m={...this.getHeaders(null==a?void 0:a.idempotencyKey),...t.headers},h=t.body;null==h||"string"!=typeof h||m["Content-Type"]||(m["Content-Type"]="application/json");for(let s=0;s<=c;s++){let a=new AbortController,r=setTimeout(()=>a.abort(),d),i=Date.now();try{let n=await fetch(e,{...t,headers:m,signal:a.signal});clearTimeout(r);let l=Date.now()-i;if(o("info","HTTP "+(t.method||"GET")+" "+e,{status:n.status,ms:l,correlationId:this.lastCorrelationId}),!n.ok){if(s<c&&u.includes(n.status)){let e=n.headers.get("retry-after"),t=Math.min(300*2**s,2e3);if(e){let s=Number(e);isNaN(s)||(t=Math.min(1e3*s,5e3))}await this.sleep(t+Math.floor(200*Math.random()));continue}let t="API Error: ".concat(n.status," ").concat(n.statusText);try{let e=await n.json();(null==e?void 0:e.message)&&(t=e.message)}catch(e){}throw o("warn",t,{status:n.status,url:e,ms:l,correlationId:this.lastCorrelationId}),Error(t)}return n}catch(u){clearTimeout(r);let a=Date.now()-i;o("error","HTTP error "+(t.method||"GET")+" "+e,{error:String((null==u?void 0:u.message)||u),ms:a,correlationId:this.lastCorrelationId}),l=u;let n=(null==u?void 0:u.name)==="AbortError",d=u instanceof TypeError||/Network error/i.test(String((null==u?void 0:u.message)||""));if(s<c&&(n||d)){await this.sleep(Math.min(300*2**s,1500));continue}throw u}}throw null!=l?l:Error("Unknown network error")}async request(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0;try{let a=this.buildUrl(e),r=await this.doFetch(a,t,s),i=r.headers.get("content-type");if(i&&i.includes("application/json"))return r.json();return r.text()}catch(e){if(e instanceof TypeError&&e.message.includes("fetch"))throw Error("Network error: Unable to connect to server");throw e}}async requestRaw(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,a=this.buildUrl(e),r=await this.doFetch(a,t,s),i=r.headers.get("content-type");return{data:i&&i.includes("application/json")?await r.json():await r.text(),response:r}}async get(e){return this.request(e,{method:"GET"})}async post(e,t){let s="idem-"+Math.random().toString(36).slice(2);return this.request(e,{method:"POST",body:void 0!==t?JSON.stringify(t):void 0},{idempotencyKey:s})}async login(e){if(!e.email||!e.password)throw Error("Email and password are required");return this.request("/api/v1/auth/login",{method:"POST",body:JSON.stringify(e),credentials:"include"})}async logout(e){return this.request("/api/v1/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}async refreshToken(e){return this.request("/api/v1/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})})}async enableMFA(){return this.request("/api/v1/auth/mfa/enable",{method:"POST"})}async verifyMFA(e){return this.request("/api/v1/auth/mfa/verify",{method:"POST",body:JSON.stringify({code:e})})}async disableMFA(e){return this.request("/api/v1/auth/mfa/disable",{method:"POST",body:JSON.stringify({password:e})})}async getTenantInfo(){return this.request("/api/v1/tenant/lookup")}async getPeople(e){let t=new URLSearchParams;return(null==e?void 0:e.page)&&t.set("page",e.page.toString()),(null==e?void 0:e.pageSize)&&t.set("pageSize",e.pageSize.toString()),(null==e?void 0:e.filter)&&t.set("filter",e.filter),this.request("/api/v1/hr/people?".concat(t))}async getPerson(e){return this.request("/api/v1/hr/people/".concat(e))}async createPerson(e){return this.request("/api/v1/hr/people",{method:"POST",body:JSON.stringify(e)})}async updatePerson(e,t){return this.request("/api/v1/hr/people/".concat(e),{method:"PUT",body:JSON.stringify(t)})}async runPayroll(e){return this.request("/api/v1/hr/payroll/run",{method:"POST",body:JSON.stringify(e)})}async punchTime(e){return this.request("/api/v1/hr/time/punch",{method:"POST",body:JSON.stringify(e)})}async listPartners(){return this.get("/api/v1/partners")}async createPartner(e){return this.request("/api/v1/partners",{method:"POST",body:JSON.stringify(e)})}async rotatePartnerCredentials(e){return this.request("/api/v1/partners/".concat(e,"/rotate-credentials"),{method:"POST"})}async listWebhooks(e){return this.get("/api/v1/partners/".concat(e,"/webhooks"))}async createWebhook(e,t){return this.request("/api/v1/partners/".concat(e,"/webhooks"),{method:"POST",body:JSON.stringify(t)})}async listPartnerLogs(e){return this.get("/api/v1/partners/".concat(e,"/logs"))}async replayDelivery(e,t){return this.request("/api/v1/partners/".concat(e,"/webhooks/").concat(t,"/replay"),{method:"POST"})}async listPartnerLogsPaged(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=new URLSearchParams;t.status&&s.set("status",t.status),t.q&&s.set("q",t.q),t.from&&s.set("from",t.from),t.to&&s.set("to",t.to),null!=t.limit&&s.set("limit",String(t.limit)),null!=t.offset&&s.set("offset",String(t.offset)),t.sort&&s.set("sort",t.sort);let{data:a,response:r}=await this.requestRaw("/api/v1/partners/".concat(e,"/logs?").concat(s.toString()));return{items:a,total:parseInt(r.headers.get("X-Total-Count")||"0",10),limit:parseInt(r.headers.get("X-Result-Limit")||String(t.limit||0),10)||t.limit||0,offset:parseInt(r.headers.get("X-Result-Offset")||String(t.offset||0),10)||t.offset||0}}async sandboxDatasets(){return this.get("/sandbox/datasets")}async sandboxEmitEvent(e,t){return this.request("/sandbox/events/".concat(encodeURIComponent(e)),{method:"POST",body:t?JSON.stringify(t):void 0})}async getWebhookCatalog(){return this.get("/webhooks/catalog")}constructor(e){this.tenantId=null,this.token=null,this.lastCorrelationId=null,this.baseURL=e}}let i=new r(a)}},function(e){e.O(0,[953,809,293,528,744],function(){return e(e.s=4571)}),_N_E=e.O()}]);